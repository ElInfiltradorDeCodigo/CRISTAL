"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2263],{2263:(L,v,s)=>{s.r(v),s.d(v,{AgregarEmpleadoPageModule:()=>q});var h=s(6814),r=s(95),n=s(7027),f=s(2891),A=s(5861),e=s(5879),I=s(6796),_=s(8330),b=s(7523),P=s(6240);function C(t,i){1&t&&(e.TgZ(0,"ion-item")(1,"ion-label",21),e._uU(2,"Por favor, introduce un nombre v\xe1lido"),e.qZA()())}function y(t,i){if(1&t&&(e.TgZ(0,"ion-select-option",22),e._uU(1),e.qZA()),2&t){const m=i.$implicit;e.Q6J("value",m.nombre_sucursal),e.xp6(1),e.hij(" ",m.nombre_sucursal," ")}}function F(t,i){if(1&t&&(e.TgZ(0,"ion-select-option",22),e._uU(1),e.qZA()),2&t){const m=i.$implicit;e.Q6J("value",m.nombre),e.xp6(1),e.hij(" ",m.nombre," ")}}const U=[{path:"",component:(()=>{var t;class i{constructor(a,o,l,g,d,c,p,Z){this.toastController=a,this.fb=o,this.afAuth=l,this.afs=g,this.db=d,this.router=c,this.storage=p,this.loadingController=Z,this.sucursales=[],this.departamentos=[],this.departamentosFiltrados=[],this.selectedImage=null,this.imagePreview="../../../assets/img/add-image.png",this.empleadoForm=this.fb.group({nombre:["",[r.kI.required,r.kI.maxLength(45)]],apellido_p:["",[r.kI.required,r.kI.maxLength(45)]],apellido_m:["",[r.kI.required,r.kI.maxLength(45)]],telefono:["",[r.kI.required,r.kI.maxLength(10)]],contrasena:["",[r.kI.required,r.kI.maxLength(50),r.kI.minLength(6)]],correo:["",[r.kI.required,r.kI.maxLength(50),r.kI.email]],sucursal:["",[r.kI.required,r.kI.maxLength(50)]],departamento:["",[r.kI.required,r.kI.maxLength(50)]]})}presentLoading(a){var o=this;return(0,A.Z)(function*(){const l=yield o.loadingController.create({message:a,spinner:"crescent"});return yield l.present(),l})()}ngOnInit(){this.cargarSucursales(),this.cargarDepartamentos()}onImageSelected(a){const o=a.target;if(o.files&&o.files[0]){if(this.selectedImage=o.files[0],!this.selectedImage.type.startsWith("image/"))return this.presentToast("Por favor, selecciona una imagen v\xe1lida"),void(this.selectedImage=null);this.previewImage(this.selectedImage)}else this.selectedImage=null}cargarSucursales(){this.db.list("SUCURSALES").valueChanges().subscribe(a=>{this.sucursales=a})}cargarDepartamentos(){this.db.list("DEPARTAMENTOS").valueChanges().subscribe(a=>{this.departamentos=a,this.filtrarDepartamentos()})}filtrarDepartamentos(){var a;const o=null===(a=this.empleadoForm.get("sucursal"))||void 0===a?void 0:a.value;this.departamentosFiltrados=this.departamentos.filter(l=>l.sucursal===o)}previewImage(a){const o=new FileReader;o.onload=()=>{this.imagePreview=o.result},o.readAsDataURL(a)}registerEmpleado(){var a=this;return(0,A.Z)(function*(){if(a.empleadoForm.valid&&a.selectedImage){const{nombre:o,apellido_p:l,apellido_m:g,telefono:d,contrasena:c,correo:p,sucursal:Z,departamento:S}=a.empleadoForm.value,E=yield a.presentLoading("Registrando empleado...");try{const u=yield a.afAuth.createUserWithEmailAndPassword(p,c);if(!u.user)throw new Error("User not returned - possible null");{const T=`userImages/${u.user.uid}`,x=a.storage.ref(T);yield a.storage.upload(T,a.selectedImage).snapshotChanges().toPromise();const J=yield x.getDownloadURL().toPromise();yield a.db.object(`EMPLEADOS/${u.user.uid}`).set({nombre:o,apellido_p:l,apellido_m:g,telefono:d,correo:p,contrasena:c,sucursal:Z,departamento:S,imageUrl:J}),E.dismiss(),a.presentToast("Empleado registrado con \xe9xito"),a.router.navigate(["/empleados"])}}catch(u){E.dismiss(),console.error("Error:",u),a.presentToast("Error al registrar empleado")}}else a.presentToast("Por favor, rellena el formulario correctamente")})()}presentToast(a){var o=this;return(0,A.Z)(function*(){(yield o.toastController.create({message:a,duration:2e3})).present()})()}}return(t=i).\u0275fac=function(a){return new(a||t)(e.Y36(n.yF),e.Y36(r.qu),e.Y36(I.zQ),e.Y36(_.ST),e.Y36(b.KQ),e.Y36(f.F0),e.Y36(P.Q1),e.Y36(n.HT))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-agregar-empleado"]],decls:41,vars:7,consts:[[3,"translucent"],["color","primary"],["slot","start"],["defaultHref","/empleados","color","secondary"],["fullscreen","true"],[3,"formGroup"],["alt","Click para seleccionar una imagen",2,"width","95px","height","95px","cursor","pointer","margin","0 auto","margin-bottom","15px",3,"src","click"],["type","file",2,"display","none",3,"change"],["fileInput",""],["formControlName","nombre","label","Nombre:","maxlength","45","required",""],[4,"ngIf"],["formControlName","apellido_p","label","Apellido Paterno:","maxlength","45","required",""],["formControlName","apellido_m","label","Apellido Materno:","maxlength","45","required",""],["formControlName","telefono","label","Tel\xe9fono:","onkeypress","return (event.charCode >= 48 && event.charCode <= 57)","maxlength","10","required",""],["formControlName","correo","label","Correo Acceso:","maxlength","50","type","email","required",""],["formControlName","contrasena","label","Contrase\xf1a:","maxlength","50","type","password","required",""],["formControlName","sucursal","placeholder","Seleccionar Sucursal",3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],["formControlName","departamento","placeholder","Seleccionar Departamento"],[1,"btn"],["color","secondary",2,"max-width","200px","margin","0 auto",3,"disabled","click"],["color","danger","position","stacked"],[3,"value"]],template:function(a,o){if(1&a){const l=e.EpF();e.TgZ(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),e._UZ(3,"ion-back-button",3),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5,"Registrar Empleado"),e.qZA()()(),e.TgZ(6,"ion-content",4)(7,"h1"),e._uU(8,"Registro De Empleado"),e.qZA(),e.TgZ(9,"form",5)(10,"ion-list")(11,"ion-item")(12,"img",6),e.NdJ("click",function(){e.CHM(l);const d=e.MAs(14);return e.KtG(d.click())}),e.qZA(),e.TgZ(13,"input",7,8),e.NdJ("change",function(d){return o.onImageSelected(d)}),e.qZA()(),e.TgZ(15,"ion-item"),e._UZ(16,"ion-input",9),e.qZA(),e.YNc(17,C,3,0,"ion-item",10),e.TgZ(18,"ion-item"),e._UZ(19,"ion-input",11),e.qZA(),e.TgZ(20,"ion-item"),e._UZ(21,"ion-input",12),e.qZA(),e.TgZ(22,"ion-item"),e._UZ(23,"ion-input",13),e.qZA(),e.TgZ(24,"ion-item"),e._UZ(25,"ion-input",14),e.qZA(),e.TgZ(26,"ion-item"),e._UZ(27,"ion-input",15),e.qZA(),e.TgZ(28,"ion-item")(29,"ion-label"),e._uU(30,"Sucursal:"),e.qZA(),e.TgZ(31,"ion-select",16),e.NdJ("ionChange",function(){return o.filtrarDepartamentos()}),e.YNc(32,y,2,2,"ion-select-option",17),e.qZA()(),e.TgZ(33,"ion-item")(34,"ion-label"),e._uU(35,"Departamento:"),e.qZA(),e.TgZ(36,"ion-select",18),e.YNc(37,F,2,2,"ion-select-option",17),e.qZA()(),e.TgZ(38,"div",19)(39,"ion-button",20),e.NdJ("click",function(){return o.registerEmpleado()}),e._uU(40,"Registrar Empleado"),e.qZA()()()()()}if(2&a){let l;e.Q6J("translucent",!0),e.xp6(9),e.Q6J("formGroup",o.empleadoForm),e.xp6(3),e.Q6J("src",o.imagePreview,e.LSH),e.xp6(5),e.Q6J("ngIf",(null==(l=o.empleadoForm.get("nombre"))?null:l.invalid)&&((null==(l=o.empleadoForm.get("nombre"))?null:l.dirty)||(null==(l=o.empleadoForm.get("nombre"))?null:l.touched))),e.xp6(15),e.Q6J("ngForOf",o.sucursales),e.xp6(5),e.Q6J("ngForOf",o.departamentosFiltrados),e.xp6(2),e.Q6J("disabled",o.empleadoForm.invalid)}},dependencies:[h.sg,h.O5,r._Y,r.JJ,r.JL,r.Q7,r.nD,n.oU,n.YG,n.Sm,n.W2,n.Gu,n.pK,n.Ie,n.Q$,n.q_,n.t9,n.n0,n.wd,n.sr,n.QI,n.j9,n.cs,r.sg,r.u]}),i})()}];let k=(()=>{var t;class i{}return(t=i).\u0275fac=function(a){return new(a||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[f.Bz.forChild(U),f.Bz]}),i})(),q=(()=>{var t;class i{}return(t=i).\u0275fac=function(a){return new(a||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[h.ez,r.u5,n.Pc,k,r.UX]}),i})()}}]);